# ingress-spire-values.yaml
# We manually add the CSI volume for SPIRE
volumes:
  - name: workload-socket
    csi:
      driver: "csi.spiffe.io"
      readOnly: true

# We mount it to the standard Istio path
volumeMounts:
  - name: workload-socket
    mountPath: "/run/secrets/workload-spiffe-uds"
    readOnly: true

# We force the proxy to use this socket
env:
  ISTIO_META_WORKLOAD_SOCKET_PATH: "/run/secrets/workload-spiffe-uds/socket"

# Optional: Add label for SPIRE logic (good practice)
labels:
  spiffe.io/spire-managed-identity: "true"
